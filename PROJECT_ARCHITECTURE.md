# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ Legal AI Vault

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- **FastAPI** - Python –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL (Neon)** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **pgvector** - –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL)
- **LangChain** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- **LangGraph** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –º–Ω–æ–≥–æ–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- **YandexGPT** - LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ (ChatYandexGPT)
- **YandexEmbeddings** - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞

**Frontend:**
- **React** + **TypeScript** + **Vite**
- **TailwindCSS** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **React Router** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- **Zustand** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

---

## üìä –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã (PDF, DOCX, TXT, XLSX)
   ‚Üì
2. POST /api/upload
   ‚Üì
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ LangChain Loaders
   - PyPDFLoader –¥–ª—è PDF
   - UnstructuredWordDocumentLoader –¥–ª—è DOCX
   - TextLoader –¥–ª—è TXT
   - CSVLoader –¥–ª—è XLSX
   ‚Üì
4. –†–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ chunks (RecursiveCharacterTextSplitter)
   - chunk_size=1000 —Å–∏–º–≤–æ–ª–æ–≤
   - chunk_overlap=200 —Å–∏–º–≤–æ–ª–æ–≤
   ‚Üì
5. –°–æ–∑–¥–∞–Ω–∏–µ embeddings —á–µ—Ä–µ–∑ YandexEmbeddings
   - –ö–∞–∂–¥—ã–π chunk –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä
   ‚Üì
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PGVector (PostgreSQL + pgvector)
   - –í—Å–µ chunks —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å metadata: {case_id, filename, chunk_index}
   - Multi-tenant –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ case_id –≤ metadata
   ‚Üì
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ files)
   ‚Üì
8. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–ª–∞ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ cases)
```

**–í–∞–∂–Ω–æ:**
- –§–∞–π–ª—ã –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- Yandex Vector Store –∏ Assistant API –±–æ–ª—å—à–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- –í—Å–µ –≤–µ–∫—Ç–æ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL —á–µ—Ä–µ–∑ pgvector

---

## üîç –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: RAG (Retrieval Augmented Generation)

### –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç–µ

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ
   ‚Üì
2. POST /api/chat {case_id, query, history}
   ‚Üì
3. RAGService.generate_with_sources()
   ‚Üì
4. RAGService.retrieve_context()
   - –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö chunks –≤ PGVector
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è YandexEmbeddings.embed_query() –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ case_id –≤ metadata
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç top-k (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5) –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   ‚Üì
5. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö chunks
   ‚Üì
6. RAGService._generate_with_direct_rag()
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
   - –í—ã–∑–æ–≤ ChatYandexGPT.invoke()
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   ‚Üì
7. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (sources)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–∞—Ö –∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
   ‚Üì
8. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ chat_messages)
   ‚Üì
9. –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É {answer, sources}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–æ–π RAG (–±–µ–∑ Yandex Assistant API)
- –ü–æ–∏—Å–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ PGVector —á–µ—Ä–µ–∑ similarity_search
- –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ top-k —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö chunks
- –û—Ç–≤–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ ChatYandexGPT —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

---

## ü§ñ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: –ú–Ω–æ–≥–æ–∞–≥–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### LangGraph Workflow

```
1. –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –¥–µ–ª–∞
   POST /api/cases/{case_id}/analyze
   ‚Üì
2. Coordinator.run_analysis()
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LangGraph StateGraph
   - –°–æ–∑–¥–∞–Ω–∏–µ thread_id = f"case_{case_id}"
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ DocumentProcessor
   ‚Üì
3. LangGraph –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥—Ä–∞—Ñ:

   START
     ‚Üì
   SUPERVISOR (–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä)
     ‚Üì (–≤—ã–±–∏—Ä–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞—á–∏)
   ‚îú‚îÄ‚Üí TRIAGE (–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
   ‚îú‚îÄ‚Üí PRIVILEGE (–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π)
   ‚îú‚îÄ‚Üí RELEVANCE (–û—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏)
   ‚îú‚îÄ‚Üí RISK (–ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤)
   ‚îú‚îÄ‚Üí SUMMARY (–†–µ–∑—é–º–µ)
   ‚îú‚îÄ‚Üí TIMELINE (–í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è)
   ‚îú‚îÄ‚Üí KEY_FACTS (–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã)
   ‚îú‚îÄ‚Üí DISCREPANCY (–ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è)
   ‚îú‚îÄ‚Üí ENTITY_EXTRACTION (–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π)
   ‚îî‚îÄ‚Üí RELATIONSHIP (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π)
     ‚Üì
   –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
     ‚Üì
   END
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤

–ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç:
1. **–ü–æ–ª—É—á–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã** —á–µ—Ä–µ–∑ DocumentProcessor.retrieve_relevant_chunks()
2. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç ChatYandexGPT** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
3. **–ò–º–µ–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç** –∏–∑ prompts.py
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** (JSON)
5. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î** (—Ç–∞–±–ª–∏—Ü—ã analysis_results, relationship_nodes, relationship_edges –∏ —Ç.–¥.)

### Checkpointing (PostgresSaver)

- LangGraph –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **PostgresSaver** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ö–∞–∂–¥—ã–π —à–∞–≥ –≥—Ä–∞—Ñ–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ checkpoints)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è
- Thread ID = `f"case_{case_id}"` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ –¥–µ–ª–∞–º

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

1. **cases** - –¥–µ–ª–∞
   - id, user_id, title, description, status
   - yandex_index_id, yandex_assistant_id (deprecated, –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)

2. **files** - —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - id, case_id, filename, file_type, file_size, upload_date
   - CASCADE —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–µ–ª–∞

3. **chat_messages** - —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
   - id, case_id, role (user/assistant), content, session_id, created_at
   - session_id = case_id (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–µ–ª–∞–º)

4. **document_embeddings** (pgvector) - –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
   - id, collection_id, embedding (vector), document (JSONB), custom_id
   - metadata —Å–æ–¥–µ—Ä–∂–∏—Ç: case_id, filename, chunk_index
   - –ò–Ω–¥–µ–∫—Å –ø–æ case_id –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

5. **analysis_results** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∞–≥–µ–Ω—Ç–æ–≤
   - id, case_id, agent_type, result (JSONB), created_at

6. **relationship_nodes** - —É–∑–ª—ã –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π
   - id, case_id, node_id, node_type, label, properties (JSONB)

7. **relationship_edges** - —Ä—ë–±—Ä–∞ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π
   - id, case_id, source_node_id, target_node_id, edge_type, properties (JSONB)

8. **checkpoints** (LangGraph) - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞
   - thread_id, checkpoint_ns, checkpoint_id, parent_checkpoint_id, type, checkpoint (JSONB)

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ Multi-tenancy

### –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

1. **–ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:**
   - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `user_id`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–µ–ª–∞

2. **–ü–æ –¥–µ–ª–∞–º (cases):**
   - –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã `case_id` –≤ metadata
   - –ü–æ–∏—Å–∫ –≤ PGVector –≤—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ `case_id`
   - CASCADE —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–µ–ª–∞

3. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫:**
   ```python
   # –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä –ø–æ case_id
   self.vector_store.as_retriever(
       search_kwargs={"k": k, "filter": {"case_id": case_id}}
   )
   ```

---

## üì° API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- `POST /api/auth/login` - –≤—Ö–æ–¥
- `GET /api/auth/me` - —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `POST /api/auth/logout` - –≤—ã—Ö–æ–¥

**–î–µ–ª–∞:**
- `GET /api/cases` - —Å–ø–∏—Å–æ–∫ –¥–µ–ª
- `POST /api/cases` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ–ª–∞
- `GET /api/cases/{case_id}` - –ø–æ–ª—É—á–∏—Ç—å –¥–µ–ª–æ
- `PUT /api/cases/{case_id}` - –æ–±–Ω–æ–≤–∏—Ç—å –¥–µ–ª–æ
- `DELETE /api/cases/{case_id}` - —É–¥–∞–ª–∏—Ç—å –¥–µ–ª–æ
- `POST /api/cases/{case_id}/analyze` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑

**–ó–∞–≥—Ä—É–∑–∫–∞:**
- `POST /api/upload` - –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã
  - –°–æ–∑–¥–∞—ë—Ç –¥–µ–ª–æ, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ LangChain
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PGVector

**–ß–∞—Ç:**
- `POST /api/chat` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  - {case_id, query, history}
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç {answer, sources}

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
- `GET /api/cases/{case_id}/documents` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `GET /api/documents/{file_id}` - —Å–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### DocumentProcessor

**–†–æ–ª—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `split_documents()` - —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ chunks
- `store_in_vector_db()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PGVector
- `retrieve_relevant_chunks()` - –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö chunks
- `get_index_id()` - –ø–æ–ª—É—á–µ–Ω–∏–µ collection_name

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:**
- YandexEmbeddings –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤
- PGVector (CaseVectorStore) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

### RAGService

**–†–æ–ª—å:** RAG (Retrieval Augmented Generation) –¥–ª—è —á–∞—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `retrieve_context()` - –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `generate_with_sources()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- `_generate_with_direct_rag()` - –ø—Ä—è–º–æ–π RAG —á–µ—Ä–µ–∑ ChatYandexGPT

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:**
- DocumentProcessor –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ChatYandexGPT –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- AdvancedRetrieverService –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

### Coordinator (LangGraph)

**–†–æ–ª—å:** –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –º–Ω–æ–≥–æ–∞–≥–µ–Ω—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `run_analysis()` - –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –¥–µ–ª–∞
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ LangGraph StateGraph

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:**
- LangGraph –¥–ª—è workflow
- PostgresSaver –¥–ª—è checkpointing
- –í—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (pgvector)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï–¥–∏–Ω–∞—è –ë–î –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –≤–µ–∫—Ç–æ—Ä–æ–≤
- ‚úÖ Multi-tenant –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ metadata
- ‚úÖ ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ Production-ready —Ä–µ—à–µ–Ω–∏–µ

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –í—Å–µ embeddings —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –¥–ª—è similarity search
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ case_id —á–µ—Ä–µ–∑ metadata JSONB

### 2. –ü—Ä—è–º–æ–π RAG (–±–µ–∑ Assistant API)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ–º–ø—Ç–∞–º–∏
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç –ª–∏—à–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤)
- ‚úÖ –ü—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö chunks –≤ PGVector
2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ chunks
3. –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ ChatYandexGPT —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### 3. LangGraph –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è workflow
- ‚úÖ Checkpointing –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ì–∏–±–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streaming

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- Supervisor –∞–≥–µ–Ω—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏
- –ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–≤–æ–µ–π –∑–∞–¥–∞—á–µ
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ checkpoints

### 4. Multi-agent —Å–∏—Å—Ç–µ–º–∞

**–ê–≥–µ–Ω—Ç—ã:**
- **Triage** - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Privilege** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- **Relevance** - –æ—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- **Risk** - –∞–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤
- **Summary** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—é–º–µ
- **Timeline** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- **Key Facts** - –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã
- **Discrepancy** - –ø–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π
- **Entity Extraction** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
- **Relationship** - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π

---

## üöÄ –î–µ–ø–ª–æ–π

### Render.com

**Backend:**
- FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- PostgreSQL (Neon) –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
- pgvector extension –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω

**Frontend:**
- React SPA
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –æ—Ç–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ FastAPI
- Build —á–µ—Ä–µ–∑ Vite

**Environment Variables:**
- `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon PostgreSQL
- `YANDEX_API_KEY` - API –∫–ª—é—á Yandex Cloud
- `YANDEX_FOLDER_ID` - ID –ø–∞–ø–∫–∏ –≤ Yandex Cloud
- `YANDEX_GPT_MODEL_URI` - URI –º–æ–¥–µ–ª–∏ GPT (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `YANDEX_EMBEDDING_MODEL_URI` - URI –º–æ–¥–µ–ª–∏ embeddings (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend  ‚îÇ
‚îÇ  (React)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ HTTP
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         FastAPI Backend              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Routes:                             ‚îÇ
‚îÇ  - /api/upload ‚Üí DocumentProcessor   ‚îÇ
‚îÇ  - /api/chat ‚Üí RAGService            ‚îÇ
‚îÇ  - /api/cases/{id}/analyze ‚Üí         ‚îÇ
‚îÇ    Coordinator (LangGraph)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚Üì                 ‚Üì                  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL  ‚îÇ  ‚îÇ ChatYandexGPT‚îÇ  ‚îÇYandexEmbeddings
‚îÇ  (Neon)      ‚îÇ  ‚îÇ  (LLM)       ‚îÇ  ‚îÇ  (Vectors)   ‚îÇ
‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ  - cases     ‚îÇ  ‚îÇ  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ‚îÇ  ‚îÇ  - –°–æ–∑–¥–∞–Ω–∏–µ  ‚îÇ
‚îÇ  - files     ‚îÇ  ‚îÇ    –æ—Ç–≤–µ—Ç–æ–≤   ‚îÇ  ‚îÇ    –≤–µ–∫—Ç–æ—Ä–æ–≤  ‚îÇ
‚îÇ  - embeddings‚îÇ  ‚îÇ  - –ê–Ω–∞–ª–∏–∑    ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ    (pgvector)‚îÇ  ‚îÇ    –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤‚îÇ  ‚îÇ              ‚îÇ
‚îÇ  - chat_msg  ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ  - analysis  ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **pgvector –≤–º–µ—Å—Ç–æ Yandex Vector Store**
   - –ï–¥–∏–Ω–∞—è –ë–î, –ª—É—á—à–µ –¥–ª—è production
   - Multi-tenant –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ metadata

2. **–ü—Ä—è–º–æ–π RAG –≤–º–µ—Å—Ç–æ Assistant API**
   - –ë–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è, –ø—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞
   - –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

3. **LangGraph –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏**
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è workflow
   - Checkpointing –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
   - –ì–∏–±–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

4. **Multi-agent —Å–∏—Å—Ç–µ–º–∞**
   - –ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã

5. **YandexGPT + YandexEmbeddings**
   - –†–æ—Å—Å–∏–π—Å–∫–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ OpenAI
   - –•–æ—Ä–æ—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK

