# –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –∏–∑—É—á–µ–Ω–∏—è LangGraph, LangChain –∏ Deep Agents

## üìö –ò–∑—É—á–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### 1. **LangGraph** (https://github.com/langchain-ai/langgraph)
**22.2k ‚≠ê | –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏**

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ Durable execution (persistent checkpoints)
- ‚úÖ Human-in-the-loop (interrupts)
- ‚úÖ Comprehensive memory
- ‚úÖ Debugging —Å LangSmith
- ‚úÖ Production-ready deployment

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

### 2. **LangChain** (https://github.com/langchain-ai/langchain)
**122k ‚≠ê | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –Ω–∞–¥–µ–∂–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤**

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–æ–¥–µ–ª—è–º–∏, –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã (`create_agent` –Ω–∞ –±–∞–∑–µ LangGraph)
- ‚úÖ RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ Memory —Å–∏—Å—Ç–µ–º—ã

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 3. **Deep Agents** (https://github.com/langchain-ai/deepagents)
**7.2k ‚≠ê | –ì–æ—Ç–æ–≤—ã–π harness –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á**

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (`write_todos`, `read_todos`)
- ‚úÖ –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (`ls`, `read_file`, `write_file`, etc.)
- ‚úÖ –ü–æ–¥-–∞–≥–µ–Ω—Ç—ã (`task` tool)
- ‚úÖ Middleware —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ Long-term memory

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** ‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º, –Ω–æ –º–æ–∂–µ–º –≤–∑—è—Ç—å –∏–¥–µ–∏

## üîç –ê–Ω–∞–ª–∏–∑ –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **LangGraph StateGraph** - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
2. **Supervisor Pattern** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
3. **Conditional Edges** - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–∏–Ω–≥
4. **Dependency Management** - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
5. **create_react_agent** - –ò—Å–ø–æ–ª—å–∑—É–µ–º prebuilt –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–Ω–æ —É—Å—Ç–∞—Ä–µ–ª)

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:

#### 1. **–£—Å—Ç–∞—Ä–µ–≤—à–∏–π API: create_react_agent**

**–¢–µ–∫—É—â–µ–µ:**
```python
from langgraph.prebuilt import create_react_agent
agent = create_react_agent(llm, tools, messages_modifier=prompt)
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (LangChain v1.0+):**
```python
from langchain.agents import create_agent
agent = create_agent(model=llm, tools=tools, system_prompt=prompt)
```

**–î–µ–π—Å—Ç–≤–∏–µ:** –°–æ–∑–¥–∞—Ç—å wrapper –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

#### 2. **MemorySaver ‚Üí PostgreSQL Checkpointer**

**–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è production!**

**–¢–µ–∫—É—â–µ–µ:**
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- –ù–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```python
from langgraph.checkpoint.postgres import PostgresSaver
checkpointer = PostgresSaver.from_conn_string(config.DATABASE_URL)
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å `langgraph-checkpoint-postgres` –≤ requirements.txt

#### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LangSmith**

**–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏:**
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å wrapper –¥–ª—è create_agent (–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

**–§–∞–π–ª:** `backend/app/services/langchain_agents/agent_factory.py` (–Ω–æ–≤—ã–π)

```python
"""Factory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é"""
from langchain_openai import ChatOpenAI
from typing import List, Any, Optional
import logging

logger = logging.getLogger(__name__)

def create_legal_agent(
    llm: ChatOpenAI,
    tools: List[Any],
    system_prompt: Optional[str] = None,
    messages_modifier: Optional[Any] = None
):
    """
    –°–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–æ–≤–æ–≥–æ –∏ —Å—Ç–∞—Ä–æ–≥–æ API
    
    Args:
        llm: LLM instance
        tools: List of tools
        system_prompt: System prompt (–Ω–æ–≤—ã–π API)
        messages_modifier: Messages modifier (—Å—Ç–∞—Ä—ã–π API)
    
    Returns:
        Compiled agent graph
    """
    # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π API
    try:
        from langchain.agents import create_agent
        prompt = system_prompt or (messages_modifier if callable(messages_modifier) else None)
        if prompt:
            agent = create_agent(
                model=llm,
                tools=tools,
                system_prompt=prompt
            )
            logger.info("Using create_agent (LangChain v1.0+)")
            return agent
    except ImportError:
        logger.debug("create_agent not available, using create_react_agent")
    
    # Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π API
    try:
        from langgraph.prebuilt import create_react_agent
        modifier = messages_modifier or system_prompt
        agent = create_react_agent(llm, tools, messages_modifier=modifier)
        logger.info("Using create_react_agent (legacy)")
        return agent
    except ImportError as e:
        raise ImportError(f"Neither create_agent nor create_react_agent available: {e}")
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —É–∑–ª–∞—Ö:**
```python
from app.services.langchain_agents.agent_factory import create_legal_agent

# –í–º–µ—Å—Ç–æ:
# agent = create_react_agent(llm, tools, messages_modifier=prompt)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
agent = create_legal_agent(llm, tools, system_prompt=prompt)
```

### –®–∞–≥ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL Checkpointer

**–§–∞–π–ª:** `backend/app/services/langchain_agents/graph.py`

```python
from langgraph.checkpoint.postgres import PostgresSaver
from langgraph.checkpoint.memory import MemorySaver
from app.config import config

def create_analysis_graph(...):
    # ...
    # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å PostgreSQL, fallback –Ω–∞ Memory
    try:
        checkpointer = PostgresSaver.from_conn_string(config.DATABASE_URL)
        # setup() –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        logger.info("Using PostgreSQL checkpointer for durable execution")
    except Exception as e:
        logger.warning(f"PostgreSQL checkpointer unavailable, using MemorySaver: {e}")
        checkpointer = MemorySaver()
    
    compiled_graph = graph.compile(checkpointer=checkpointer)
    return compiled_graph
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –≤ `requirements.txt`: `langgraph-checkpoint-postgres>=0.1.0`
- –í—ã–∑–≤–∞—Ç—å `checkpointer.setup()` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å LangSmith (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª:** `backend/app/config.py`

```python
# LangSmith Settings (optional)
LANGSMITH_API_KEY: str = os.getenv("LANGSMITH_API_KEY", "")
LANGSMITH_PROJECT: str = os.getenv("LANGSMITH_PROJECT", "legal-ai-vault")
LANGSMITH_TRACING: bool = os.getenv("LANGCHAIN_TRACING_V2", "false").lower() == "true"
```

**–§–∞–π–ª:** `backend/app/main.py` (–≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞)

```python
if config.LANGSMITH_TRACING and config.LANGSMITH_API_KEY:
    import os
    os.environ["LANGCHAIN_TRACING_V2"] = "true"
    os.environ["LANGCHAIN_API_KEY"] = config.LANGSMITH_API_KEY
    os.environ["LANGCHAIN_PROJECT"] = config.LANGSMITH_PROJECT
    logger.info("‚úÖ LangSmith tracing enabled")
```

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | LangGraph | Deep Agents |
|------------|----------------|-----------|-------------|
| StateGraph | ‚úÖ | ‚úÖ | ‚úÖ (–≤–Ω—É—Ç—Ä–∏) |
| Supervisor Pattern | ‚úÖ | ‚úÖ | ‚úÖ |
| Durable Execution | ‚ö†Ô∏è MemorySaver | ‚úÖ PostgresSaver | ‚úÖ |
| Human-in-the-Loop | ‚ùå | ‚úÖ | ‚úÖ |
| LangSmith | ‚ùå | ‚úÖ | ‚úÖ |
| Middleware | ‚ùå | ‚ö†Ô∏è | ‚úÖ |
| –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå | ‚ö†Ô∏è | ‚úÖ |
| –ü–æ–¥-–∞–≥–µ–Ω—Ç—ã | ‚ùå | ‚úÖ | ‚úÖ |
| –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ | ‚ùå | ‚ö†Ô∏è | ‚úÖ |

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–ª—É—á—à–µ–Ω–∏–π

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (Production-ready):

1. **PostgreSQL Checkpointer** ‚≠ê‚≠ê‚≠ê
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ª–≥–∏—Ö –∑–∞–¥–∞—á
   - –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

2. **Wrapper –¥–ª—è create_agent** ‚≠ê‚≠ê‚≠ê
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤–æ–≥–æ API
   - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### üü° –í–∞–∂–Ω–æ (–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥):

3. **LangSmith –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚≠ê‚≠ê
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚≠ê‚≠ê
   - Retry –ª–æ–≥–∏–∫–∞
   - Graceful degradation

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):

5. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚≠ê
6. **Middleware —Å–∏—Å—Ç–µ–º–∞** ‚≠ê
7. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–µ–ª** ‚≠ê

## üìù –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

1. **LANGGRAPH_ANALYSIS.md** - –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
2. **LANGGRAPH_DEEP_ANALYSIS.md** - –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
3. **MIGRATION_RECOMMENDATIONS.md** - –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
4. **LANGGRAPH_STUDY_SUMMARY.md** - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç (—Ä–µ–∑—é–º–µ)

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LangGraph
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
- ‚úÖ –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∞
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–π API (`create_react_agent`)
- ‚ö†Ô∏è –ù–µ—Ç persistent checkpointer

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –°–æ–∑–¥–∞—Ç—å wrapper –¥–ª—è `create_agent` (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL checkpointer (–∫—Ä–∏—Ç–∏—á–Ω–æ)
3. –î–æ–±–∞–≤–∏—Ç—å LangSmith –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
4. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–≤–∞–∂–Ω–æ)

**Deep Agents:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—à–µ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ù–æ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–¥–µ–∏ (middleware, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å wrapper –∏ PostgreSQL checkpointer –¥–ª—è production-ready —Å–∏—Å—Ç–µ–º—ã.
